
<div class="container-fluid">
	<div class="page-header">
  		<h1><small>Menu of</small> Drinks</h1>
	</div>


	<div class="row">
		<div class="col-md-4">
			<input id="new_category" type="text" class="form-control" placeholder="add a new categroy">
		</div>
	</div>


	<div class="row" id="show_panel">
	</div>

</div>

<script language="javascript">

$(document).ready(ready);
//$(document).on('page:load', ready);
//$(document).on('page:change', ready);


function ready()
{console.log(arguments.callee.name);

	$(document).on( 'keypress', '#new_category', newCategoryOnPress );
	$(document).on( 'keypress', '.form-control.sub-item', newSubItemOnPress );
	$(document).on( 'click', '.glyphicon.glyphicon-remove.category-remove', removeCategoryOnclick );
	$(document).on( 'click', '.glyphicon.glyphicon-remove.item-remove', removeItemOnclick );


	$(document).on( 'dblclick', '.list-group-item', listOnDbclick );

	
	$(document).on( 'mouseover', '.category-panel', listOnOver);
	$(document).on( 'mouseleave', '.category-panel', listOnLeave);

	$(document).on( 'mouseover', '.list-group-item', headOnOver);
	$(document).on( 'mouseleave', '.list-group-item', headOnLeave);
}


function listOnDbclick()
{
	var context = $(this).children().first().text();
	var rc = prompt("",context);
	if(rc==null)
		return;

	$(this).children().first().text(rc);
}


function headOnOver()
{console.log(arguments.callee.name);

	$(this).find('.pull-right' ).fadeIn( 100 );
}

function headOnLeave()
{console.log(arguments.callee.name);

	$(this).find('.pull-right' ).fadeOut( 100 );
}


function listOnOver()
{console.log(arguments.callee.name);

	$(this).find('.list-group-item-sm' ).fadeIn( 500 );
}

function listOnLeave()
{console.log(arguments.callee.name);

	$(this).find('.list-group-item-sm' ).fadeOut( 100 );
}


function removeItemOnclick()
{console.log(arguments.callee.name);

	$(this).parent().parent().remove();
}


function removeCategoryOnclick()
{console.log(arguments.callee.name);

	if(!confirm("Do you remove this list?"))
		return;

	var id = $(this).parentsUntil('.category-panel').parent().prop('id');
	$('#'+id).remove();
}


function newSubItemOnPress(e)
{console.log(arguments.callee.name);

	code = (e.keyCode ? e.keyCode : e.which);
	if (code != 13)
		return;

	var itemName = $.trim($(this).val());
	if(itemName.length<=0)
		return;


	var content = [
		'<div class="list-group-item">',
			'<span>',
				itemName,
			'</span>',
			'<span class="pull-right" style="display:none">',
				'<span class="glyphicon glyphicon-chevron-up item-remove"></span>',
				'<span class="glyphicon glyphicon-chevron-down item-remove"></span>',
				'&nbsp&nbsp',
				'<span class="glyphicon glyphicon-remove item-remove"></span>',
			'</span>',
		'</div>'
	].join('');
	

	$(this).val('');
	$(this).parent().before(content);
}


function newCategoryOnPress(e)
{console.log(arguments.callee.name);

	code = (e.keyCode ? e.keyCode : e.which);
	if (code != 13)
		return;

	var categoryName = $.trim($(this).val());
	if(categoryName.length<=0)
		return;

	var i=1;
	var id='';
	while(true)
	{
		id = 'category_panel_id_'+i;
		if( $('#'+id).length<=0 )
			break;

		i++;
	}


	var newPanel = generateList(id, categoryName);
	$('#show_panel').append(newPanel);
	$(this).val('');
}


function generateList(id, categoryName)
{
	var data =[
		'<div class="col-md-2 category-panel" id="'+id+'">',
			'<div class="list-group">',
				'<div class="list-group-item active">',
					'<span>'+categoryName+'</span>',
					'<span class="pull-right" style="display:none">',
						'<span class="glyphicon glyphicon-chevron-left category-remove"></span>',
						'<span class="glyphicon glyphicon-chevron-right category-remove"></span>',
						'&nbsp&nbsp',
						'<span class="glyphicon glyphicon-remove category-remove"></span>',
					'</span>',
				'</div>',
				'<div class="list-group-item-sm" style="display:none">',
					'<input type="text" class="form-control sub-item" placeholder="add a new item">',
				'</div>',
			'</div>',
		'</div>'
	];

	return data.join('');
}

</script>
